<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Japanese Cards - Professional Edition</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1e1e1e;
      --border: #333;
      --text: #e0e0e0;
      --muted: #a0a0a0;
      --accent: #cfb53b;
      --radius: 8px;
      --maxw: 1100px;
      
      /* 同步 kw130 字級：緊湊型工具書比例 */
      --h1: 1.5rem;
      --cardTitle: 1.1rem;
      --body: 0.88rem;
      --small: 0.75rem;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      /* 同步 kw130 字體順序：移除手動字距，讓 Meiryo 原生緊湊感發揮 */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft JhengHei", "Meiryo", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      letter-spacing: 0;
      -webkit-font-smoothing: antialiased;
    }

    .wrap { max-width: var(--maxw); margin: 0 auto; padding: 16px; }
    header { text-align: center; padding: 8px 0; }
    h1 { margin: 0; font-size: var(--h1); color: var(--accent); letter-spacing: -0.01em; }

    /* 手機版優化：控制列排版 */
    .controls { margin: 15px 0; display: flex; flex-direction: column; gap: 8px; }
    .input {
      width: 100%; background: var(--card); border: 1px solid var(--border);
      color: var(--text); border-radius: 6px; padding: 10px 12px;
      font-size: 0.95rem; outline: none; transition: border-color 0.2s;
    }
    .select-group { display: flex; gap: 8px; }
    .select {
      flex: 1; background: var(--card); border: 1px solid var(--border);
      color: var(--text); border-radius: 6px; padding: 8px 10px;
      font-size: 0.85rem; cursor: pointer; outline: none; min-width: 0;
    }
    .input:focus, .select:focus { border-color: var(--accent); }

    /* 資訊條優化：水平滑動不換行 */
    .chips {
      display: flex; gap: 6px; overflow-x: auto; padding-bottom: 8px;
      margin-bottom: 10px; scrollbar-width: none;
    }
    .chips::-webkit-scrollbar { display: none; }
    .chip {
      white-space: nowrap; background: #252525; border: 1px solid var(--border);
      padding: 3px 10px; border-radius: 4px; font-size: 0.72rem; color: var(--muted);
    }
    .chip strong { color: var(--accent); }

    /* 卡片設計 */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
    @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 14px; transition: transform 0.15s ease;
    }
    .cardHead { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    
    .term {
      font-size: var(--cardTitle); 
      font-weight: 600; /* 同步 kw130 字重 */
      color: var(--accent);
      margin: 0;
      letter-spacing: -0.01em; /* 微調標題字距，讓日文更紮實 */
      line-height: 1.2;
    }
    
    .tags { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
    .tag { font-size: 0.65rem; color: var(--muted); border: 1px solid var(--border); padding: 1px 6px; border-radius: 4px; }

    .sec { margin-top: 10px; }
    
    /* 回歸的小色塊裝飾 */
    .secTitle {
      font-size: 0.72rem; font-weight: 700; color: var(--muted);
      margin-bottom: 6px; display: flex; align-items: center; gap: 6px;
      text-transform: uppercase;
    }
    .secTitle::before {
      content: ""; width: 3px; height: 11px; background: var(--accent);
      border-radius: 1px; display: inline-block;
    }

    .meaning { margin: 0 0 0 2px; font-size: var(--body); line-height: 1.5; color: #ddd; }
    
    /* 例文色塊優化 */
    .example {
      margin: 4px 0 0; padding: 10px 12px; background: #262626;
      border-radius: 6px; font-size: var(--body); font-weight: 400;
      color: #ccc; line-height: 1.6; border-left: 3px solid #444;
      white-space: pre-wrap;
    }

    .empty { text-align: center; padding: 40px; color: var(--muted); font-size: var(--body); }
    .muted-text { font-size: 0.75rem; color: #555; padding-left: 2px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header><h1 id="pageTitle">Loading...</h1></header>

    <div class="controls">
      <input id="q" class="input" placeholder="搜尋：日文 / 意義 / 例句" />
      <div class="select-group">
        <select id="cat" class="select"></select>
        <select id="type" class="select"></select>
      </div>
    </div>

    <div class="chips" id="chips"></div>
    <div class="grid" id="grid"></div>
    <div id="empty" class="empty" style="display:none;">找不到符合條件的條目</div>
  </div>

  <script>
    // --- 資料區：請將您的資料貼回此處 ---
    const RAW_DATA = `
日文高頻詞彙庫範例

い形容詞{
うまい：好吃的：このラーメンはうまい。
}
な形容詞{
きれい：漂亮的：この花はとてもきれいです。
}
オノマトペ{
心理・情緒{
もやもy：心裡悶悶的：なんか理由はないけど、ずっともやもやしてる。
}
}
`.trim();
    // ---------------------------------

    function parseDataset(raw) {
      const lines = raw.split('\n').map(l => l.trim()).filter(l => l);
      const title = lines[0] || "Japanese Cards";
      const flat = [];
      const structure = {}; 

      let currentMain = null;
      let currentSub = null;

      lines.slice(1).forEach(line => {
        if (line.endsWith('{')) {
          const name = line.replace('{', '').trim();
          if (!currentMain) {
            currentMain = name;
            structure[currentMain] = [];
          } else {
            currentSub = name;
            if (!structure[currentMain].includes(currentSub)) structure[currentMain].push(currentSub);
          }
        } else if (line === '}') {
          if (currentSub) currentSub = null;
          else currentMain = null;
        } else if (line.includes('：')) {
          const p = line.split('：');
          flat.push({
            mainCat: currentMain,
            subCat: currentSub || currentMain,
            term: p[0].trim(),
            meaning: (p[1] || "").trim(),
            example: p.slice(2).join('：').trim() || null
          });
        }
      });
      return { title, flat, structure };
    }

    const ds = parseDataset(RAW_DATA);
    const state = { q: "", cat: "ALL", type: "ALL" };
    const els = {
      title: document.getElementById("pageTitle"),
      q: document.getElementById("q"),
      cat: document.getElementById("cat"),
      type: document.getElementById("type"),
      grid: document.getElementById("grid"),
      chips: document.getElementById("chips"),
      empty: document.getElementById("empty")
    };

    function init() {
      els.title.textContent = ds.title;
      buildSelect(els.cat, Object.keys(ds.structure), "所有大類");
      updateTypeSelect();
      render();
    }

    function buildSelect(el, opts, allLabel) {
      el.innerHTML = `<option value="ALL">${allLabel}</option>`;
      opts.forEach(o => {
        const opt = document.createElement("option");
        opt.value = opt.textContent = o;
        el.appendChild(opt);
      });
    }

    function updateTypeSelect() {
      if (state.cat === "ALL") {
        els.type.innerHTML = `<option value="ALL">全部型態</option>`;
        els.type.disabled = true;
      } else {
        const subs = ds.structure[state.cat] || [];
        buildSelect(els.type, subs, "全部型態");
        els.type.disabled = subs.length === 0;
      }
      state.type = "ALL";
    }

    function render() {
      const filtered = ds.flat.filter(item => {
        if (state.cat !== "ALL" && item.mainCat !== state.cat) return false;
        if (state.type !== "ALL" && item.subCat !== state.type) return false;
        if (state.q) {
          const s = `${item.term} ${item.meaning} ${item.example}`.toLowerCase();
          if (!state.q.toLowerCase().split(' ').every(k => s.includes(k))) return false;
        }
        return true;
      });

      els.grid.innerHTML = filtered.map(item => `
        <article class="card">
          <div class="cardHead">
            <h2 class="term">${item.term}</h2>
            <div class="tags">
              <span class="tag">${item.mainCat}</span>
              ${item.subCat !== item.mainCat ? `<span class="tag">${item.subCat}</span>` : ''}
            </div>
          </div>
          <div class="sec">
            <h3 class="secTitle">Meaning</h3>
            <p class="meaning">${item.meaning}</p>
          </div>
          <div class="sec">
            <h3 class="secTitle">Example</h3>
            ${item.example ? `<p class="example">${item.example}</p>` : `<div class="muted-text">（暫無例句）</div>`}
          </div>
        </article>
      `).join('');

      els.empty.style.display = filtered.length ? "none" : "block";
      renderChips(filtered.length);
    }

    function renderChips(count) {
      els.chips.innerHTML = `
        <div class="chip">顯示 <strong>${count}</strong></div>
        <div class="chip">大類: <strong>${state.cat}</strong></div>
        ${state.type !== "ALL" ? `<div class="chip">型態: <strong>${state.type}</strong></div>` : ""}
      `;
    }

    els.q.addEventListener("input", e => { state.q = e.target.value; render(); });
    els.cat.addEventListener("change", e => { state.cat = e.target.value; updateTypeSelect(); render(); });
    els.type.addEventListener("change", e => { state.type = e.target.value; render(); });

    init();
  </script>
</body>
</html>
